<form [formGroup]="loanProductSettingsForm">

  <div fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column" fxLayoutAlign.gt-sm="start center">

    <mat-form-field fxFlex="31%">
      <mat-label>{{'labels.inputs.products.loan.Amortization' | translate}}</mat-label>
      <mat-select formControlName="amortizationType" matTooltip="{{ 'tooltips.The Amortization value' | translate }}" required>
        <mat-option *ngFor="let amortizationType of amortizationTypeData" [value]="amortizationType.id">
          {{'labels.inputs.products.loan.amortizationType.' + amortizationType.value | translate}}
        </mat-option>
      </mat-select>
      <mat-error>
        {{'labels.commons.Amortization is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-checkbox fxFlex="15%" labelPosition="before" formControlName="isEqualAmortization">
      {{'labels.inputs.products.loan.Is Equal Amortization?' | translate}}
    </mat-checkbox>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Interest Method' | translate }}</mat-label>
      <mat-select formControlName="interestType" matTooltip="{{ 'tooltips.The Interest method value' | translate }}" required>
        <mat-option *ngFor="let interestType of interestTypeData" [value]="interestType.id">
          {{ "labels.inputs.products.loan.interestType." + interestType.value | translate }}
        </mat-option>
      </mat-select>
      <mat-error>
        {{'labels.commons.Interest Method is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Interest Calculation Period' | translate }}</mat-label>
      <mat-select formControlName="interestCalculationPeriodType"
                  matTooltip="{{ 'tooltips.Daily - Will Calculate the interest' | translate }}" required>
        <mat-option *ngFor="let interestCalculationPeriodType of interestCalculationPeriodTypeData" [value]="interestCalculationPeriodType.id">
          {{ "labels.inputs.products.loan.interestCalculationPeriodType." + interestCalculationPeriodType.value | translate }}
        </mat-option>
      </mat-select>
      <mat-error>
        {{'labels.commons.Interest calculation period is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-checkbox *ngIf="loanProductSettingsForm.value.interestCalculationPeriodType === 1" fxFlex="48%" labelPosition="before"
                  matTooltip="{{ 'tooltips.To be used with SAME AS REPAYMENT PERIOD' | translate }}"
                  formControlName="allowPartialPeriodInterestCalcualtion">
      {{'labels.inputs.Calculate interest for exact days in partial period' | translate }}
    </mat-checkbox>

    <mat-divider fxFlex="98%"></mat-divider>

    <h4 fxFlex="98%" class="mat-h4">{{'labels.heading.Loan Schedule' | translate }}</h4>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Loan Schedule Type' | translate }}</mat-label>
      <mat-select formControlName="loanScheduleType" required>
        <mat-option *ngFor="let loanScheduleType of loanScheduleTypeData" [value]="loanScheduleType.code">
          {{ "labels.inputs.products.loan.loanScheduleType." + loanScheduleType.value | translate }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Repayment strategy' | translate }}</mat-label>
      <mat-select formControlName="transactionProcessingStrategyCode" matTooltip="{{ 'tooltips.The repayment strategy' | translate }}"
                  required [disabled]="advancedTransactionProcessingStrategyDisabled">
        <mat-option *ngFor="let transactionProcessingStrategy of transactionProcessingStrategyData" [value]="transactionProcessingStrategy.code">
          {{ "labels.inputs.products.loan.transactionProcessingStrategy." + transactionProcessingStrategy.name | translate }}
        </mat-option>
      </mat-select>
      <mat-error>
        {{'labels.commons.Repayment strategy is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%" *ngIf="isAdvancedTransactionProcessingStrategy">
      <mat-label>{{'labels.inputs.Loan Schedule Processing Type' | translate }}</mat-label>
      <mat-select formControlName="loanScheduleProcessingType" required>
        <mat-option *ngFor="let loanScheduleProcessingType of loanScheduleProcessingTypeData" [value]="loanScheduleProcessingType.code">
          {{ loanScheduleProcessingType.value }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Payment due on non working days' | translate }}</mat-label>
      <mat-select formControlName="repaymentReschedulingType">
        <mat-option *ngFor="let repaymentReschedulingType of repaymentReschedulingTypeData" [value]="repaymentReschedulingType.id">
          {{ "repaymentReschedulingType."+repaymentReschedulingType.value | translate  }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="extendTermForMonthlyRepayments" class="margin-v">
      {{'labels.text.Enable extended' |translate}}
    </mat-checkbox>

    <h3 fxFlex="96%" class="mat-h3">{{'labels.heading.Loan Tranche Details' | translate }}</h3>

    <mat-checkbox fxFlex="73%" labelPosition="before" formControlName="multiDisburseLoan"
                  matTooltip="{{ 'tooltips.Leave this checkbox unchecked' | translate }}" class="margin-b">
      {{'labels.inputs.Enable Multiple Disbursals' | translate }}
    </mat-checkbox>

    <div *ngIf="loanProductSettingsForm.value.multiDisburseLoan" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">
      <mat-form-field fxFlex="48%">
        <mat-label>{{'labels.inputs.Maximum Tranche count' | translate }}</mat-label>
        <input type="number" matInput matTooltip="{{ 'tooltips.Maximum number of disbursements' | translate }}" formControlName="maxTrancheCount" required>
        <mat-error *ngIf="loanProductSettingsForm.controls.maxTrancheCount.hasError('required')">
          {{'labels.commons.Maximum Tranche count is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="48%">
        <mat-label>{{'labels.inputs.Maximum allowed outstanding balance' | translate }}</mat-label>
        <input type="number" matInput matTooltip="{{ 'tooltips.Maximum outstanding loan account balance' | translate }}" formControlName="outstandingLoanBalance">
      </mat-form-field>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="disallowExpectedDisbursements" class="margin-v">
        {{'labels.inputs.Disallow Expected Disbursements' | translate }}
      </mat-checkbox>
    </div>

    <h3 fxFlex="96%" class="mat-h3">{{'labels.heading.Down Payment' | translate }}</h3>

    <mat-checkbox fxFlex="73%" labelPosition="before" formControlName="enableDownPayment" matTooltip="{{ 'tooltips.Leave this checkbox checked' | translate }}" class="margin-b">
      {{'labels.inputs.Enable Down Payment' | translate }}
    </mat-checkbox>

    <div *ngIf="loanProductSettingsForm.value.enableDownPayment" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">
      <mat-form-field fxFlex="48%">
        <mat-label>{{'labels.inputs.Disbursed Amount Percentage Down Payment (%)' | translate }}</mat-label>
        <input type="number" matInput matTooltip="{{ 'tooltips.The percentage of disbursements amount for Down Payment' | translate }}"
               formControlName="disbursedAmountPercentageForDownPayment" required [min]="0" [max]="100">
        <mat-error *ngIf="loanProductSettingsForm.controls.disbursedAmountPercentageForDownPayment.hasError('required')">
          {{'labels.commons.Disbursed Amount Percentage Down Payment is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
        <mat-error *ngIf="loanProductSettingsForm.controls.disbursedAmountPercentageForDownPayment.errors?.range">
          {{'labels.commons.Disbursed Amount Percentage Down Payment is out' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="enableAutoRepaymentForDownPayment" matTooltip="{{ 'tooltips.Enable or disable  the auto repayment' | translate }}"  class="margin-b">
        {{'labels.inputs.Enable Auto Repayment for Down Payment' | translate }}
      </mat-checkbox>
    </div>

    <mat-divider fxFlex="98%"></mat-divider>

    <span fxFlex="48%" fxHide.lt-md></span>

    <h4 fxFlex="98%" class="mat-h4"> {{'labels.heading.Moratorium' | translate }} <i class="fas fa-question" matTooltip="{{ 'tooltips.The moratorium information' | translate }}"></i></h4>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Grace on principal payment' | translate }}</mat-label>
      <input type="number" matInput formControlName="graceOnPrincipalPayment">
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Grace on interest payment' | translate }}</mat-label>
      <input type="number" matInput formControlName="graceOnInterestPayment">
    </mat-form-field>

    <mat-divider fxFlex="98%"></mat-divider>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Delinquency Bucket' | translate }}</mat-label>
      <mat-select formControlName="delinquencyBucketId">
        <mat-option *ngFor="let delinquencyBucket of delinquencyBucketData" [value]="delinquencyBucket.id">
          {{ delinquencyBucket.name }}
        </mat-option>
      </mat-select>
      <button mat-button *ngIf="loanProductSettingsForm.controls.delinquencyBucketId" matSuffix mat-icon-button
              aria-label="Clear" (click)="clearProperty($event, 'delinquencyBucketId')">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="enableInstallmentLevelDelinquency" class="margin-v">
      {{'labels.inputs.Enable installment level Delinquency' | translate }}
    </mat-checkbox>

    <mat-divider fxFlex="98%"></mat-divider>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Interest free period' | translate }}</mat-label>
      <input type="number" matInput matTooltip="{{ 'tooltips.If the Interest Free Period' | translate }}" formControlName="graceOnInterestCharged">
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Arrears tolerance' | translate }}</mat-label>
      <input type="number" matInput matTooltip="{{ 'tooltips.With Arrears tolerance' | translate }}" formControlName="inArrearsTolerance">
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Days in Year' | translate }}</mat-label>
      <mat-select matTooltip="{{ 'tooltips.The setting for number of days' | translate }}" formControlName="daysInYearType" required>
        <mat-option *ngFor="let daysInYearType of daysInYearTypeData" [value]="daysInYearType.id">
          {{ daysInYearType.value }}
        </mat-option>
      </mat-select>
      <mat-error>
        {{'labels.commons.Days in year is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Days in month' | translate }}</mat-label>
      <mat-select matTooltip="{{ 'tooltips.Number of days in month' | translate }}" formControlName="daysInMonthType" required>
        <mat-option *ngFor="let daysInMonthType of daysInMonthTypeData" [value]="daysInMonthType.id">
          {{ daysInMonthType.value }}
        </mat-option>
      </mat-select>
      <mat-error>
        {{'labels.commons.Days in month is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
      </mat-error>
    </mat-form-field>

    <mat-checkbox fxFlex="98%" labelPosition="before" formControlName="canDefineInstallmentAmount" class="margin-v">
      {{'labels.inputs.Allow fixing of the installment amount' | translate }}
    </mat-checkbox>

    <h4 fxFlex="48%" class="mat-h4">{{'labels.inputs.Number of days a loan may be overdue before moving into arrears' | translate }} <i class="fas fa-question"
                                                                                                                                        matTooltip="{{ 'tooltips.A loan is in arrears once the number of days' | translate }}"></i></h4>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.On arrears ageing' | translate }}</mat-label>
      <input type="number" matInput formControlName="graceOnArrearsAgeing">
    </mat-form-field>

    <h4 fxFlex="48%" class="mat-h4">{{'labels.inputs.Maximum number of days a loan may be overdue before becoming a NPA (non performing asset)' | translate }} <i class="fas fa-question"
                                                                                                                                                                  matTooltip="{{ 'tooltips.NPA (non performing asset) once the number of days' | translate }}"></i></h4>

    <mat-form-field fxFlex="48%">
      <mat-label>{{'labels.inputs.Overdue days for NPA' | translate }}</mat-label>
      <input type="number" matInput formControlName="overdueDaysForNPA">
    </mat-form-field>


    <h4 fxFlex="48%" class="mat-h4">{{ 'labels.inputs.products.loan.Amount for NPA' | translate}} <i class="fas fa-question"
                                                                                                     matTooltip="{{ 'tooltips.Amount for NPA' | translate }}"></i></h4>

    <mat-form-field fxFlex="48%">
      <mat-label>{{ 'labels.inputs.products.loan.Amount for NPA' | translate}}</mat-label>
      <input type="number" matInput formControlName="overdueAmountForArrearsConsideration">
    </mat-form-field>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="accountMovesOutOfNPAOnlyOnArrearsCompletion" class="margin-v">
       {{"labels.inputs.Account moves out of NPA only after all arrears have been cleared" | translate}}
    </mat-checkbox>

    <mat-form-field fxFlex="48%">
      <mat-label>{{"labels.inputs.Principal Threshold (%) for Last Instalment" | translate}}</mat-label>
      <input type="number" matInput formControlName="principalThresholdForLastInstallment">
    </mat-form-field>

    <mat-checkbox fxFlex="48%" labelPosition="before" matTooltip="{{ 'tooltips.Fields are used to define the minimum, maximum gap' | translate }}" formControlName="allowVariableInstallments" class="margin-v">
      {{"labels.inputs.Are Variable Installments Allowed?" | translate}}
    </mat-checkbox>

    <div *ngIf="loanProductSettingsForm.value.allowVariableInstallments" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

      <h4 fxFlex="98%" class="mat-h4">{{"labels.inputs.Variable Installments" | translate}}</h4>

      <mat-form-field fxFlex="48%">
        <mat-label>{{"labels.inputs.Minimum gap between Installments" | translate}}</mat-label>
        <input type="number" matInput formControlName="minimumGap" required>
        <mat-error>
          {{'labels.commons.Minimum gap between Installments is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="48%">
        <mat-label>{{"labels.inputs.Maximum gap between Installments" | translate}}</mat-label>
        <input type="number" matInput formControlName="maximumGap" required>
        <mat-error>
          {{'labels.commons.Maximum gap between Installments is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

    </div>

    <mat-checkbox fxFlex="48%" labelPosition="before" matTooltip="{{ 'tooltips.Loan Product can be used to apply for Topup Loans' | translate }}" formControlName="canUseForTopup" class="margin-v">
      {{"labels.inputs.Allowed to be used for providing Topup Loans" | translate}}
    </mat-checkbox>

    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="23%" class="mat-h3">{{"labels.heading.Interest Recalculation" | translate}}</h3>

    <mat-checkbox fxFlex="73%" labelPosition="before" formControlName="isInterestRecalculationEnabled" class="margin-b">
      {{"labels.inputs.Recalculate Interest" | translate}}
    </mat-checkbox>

    <div *ngIf="loanProductSettingsForm.value.isInterestRecalculationEnabled" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

      <mat-form-field fxFlex="48%">
        <mat-label>{{"labels.inputs.Pre-closure interest calculation rule" | translate}}</mat-label>
        <mat-select formControlName="preClosureInterestCalculationStrategy" required>
          <mat-option *ngFor="let preClosureInterestCalculationStrategy of preClosureInterestCalculationStrategyData" [value]="preClosureInterestCalculationStrategy.id">
            {{ preClosureInterestCalculationStrategy.value }}
          </mat-option>
        </mat-select>
        <mat-error>
          {{'labels.commons.Pre-closure interest calculation rule is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="48%">
        <mat-label>{{"labels.inputs.Advance payments adjustment type" | translate}}</mat-label>
        <mat-select formControlName="rescheduleStrategyMethod" required>
          <mat-option *ngFor="let rescheduleStrategyType of rescheduleStrategyTypeData" [value]="rescheduleStrategyType.id">
            {{ rescheduleStrategyType.value }}
          </mat-option>
        </mat-select>
        <mat-error>
          {{'labels.commons.Advance payments adjustment type is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="48%">
        <mat-label>{{"labels.inputs.Interest recalculation compounding on" | translate}}</mat-label>
        <mat-select formControlName="interestRecalculationCompoundingMethod" required>
          <mat-option *ngFor="let interestRecalculationCompoundingType of interestRecalculationCompoundingTypeData" [value]="interestRecalculationCompoundingType.id">
            {{ interestRecalculationCompoundingType.value }}
          </mat-option>
        </mat-select>
        <mat-error>
          {{'labels.commons.Interest recalculation compounding on is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

      <span fxFlex="48%" fxHide.lt-md></span>

      <div fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

        <mat-form-field fxFlex="48%" *ngIf="loanProductSettingsForm.value.interestRecalculationCompoundingMethod !== 0 && loanProductSettingsForm.value.recalculationCompoundingFrequencyType !== 1">
          <mat-label>{{"labels.inputs.Frequency Interval for compounding" | translate}}</mat-label>
          <input type="number" matInput formControlName="recalculationCompoundingFrequencyInterval" required>
          <mat-error>
            {{'labels.commons.Frequency Interval for compounding is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
          </mat-error>
        </mat-form-field>

        <mat-form-field fxFlex="48%" *ngIf="loanProductSettingsForm.value.recalculationRestFrequencyType !== 1">
          <mat-label>{{"labels.inputs.Frequency Interval for recalculation" | translate}}</mat-label>
          <input type="number" matInput formControlName="recalculationRestFrequencyInterval" required>
          <mat-error>
            {{'labels.commons.Frequency Interval for recalculation is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
          </mat-error>
        </mat-form-field>

      </div>

      <div *ngIf="loanProductSettingsForm.value.interestRecalculationCompoundingMethod !== 0" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

        <mat-form-field fxFlex="31%">
          <mat-label>{{"labels.inputs.Frequency for compounding" | translate}}</mat-label>
          <mat-select formControlName="recalculationCompoundingFrequencyType" required>
            <mat-option *ngFor="let interestRecalculationFrequencyType of interestRecalculationFrequencyTypeData" [value]="interestRecalculationFrequencyType.id">
              {{ interestRecalculationFrequencyType.value }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div *ngIf="loanProductSettingsForm.value.recalculationCompoundingFrequencyType === 4" fxFlex="31%" fxLayout="row" fxLayout.lt-md="column">

          <mat-form-field fxFlexFill>
            <mat-select formControlName="recalculationCompoundingFrequencyNthDayType">
              <mat-option *ngFor="let interestRecalculationNthDayType of interestRecalculationNthDayTypeData" [value]="interestRecalculationNthDayType.id">
                {{ interestRecalculationNthDayType.value }}
              </mat-option>
            </mat-select>
          </mat-form-field>

        </div>

        <div *ngIf="(loanProductSettingsForm.value.recalculationCompoundingFrequencyType === 4 && loanProductSettingsForm.value.recalculationCompoundingFrequencyNthDayType !== -2) ||
        loanProductSettingsForm.value.recalculationCompoundingFrequencyType === 3" fxFlex="31%" fxLayout="row" fxLayout.lt-md="column">

          <mat-form-field fxFlexFill>
            <mat-select formControlName="recalculationCompoundingFrequencyDayOfWeekType">
              <mat-option *ngFor="let interestRecalculationDayOfWeekType of interestRecalculationDayOfWeekTypeData" [value]="interestRecalculationDayOfWeekType.id">
                {{ interestRecalculationDayOfWeekType.value }}
              </mat-option>
            </mat-select>
          </mat-form-field>

        </div>

        <div *ngIf="loanProductSettingsForm.value.recalculationCompoundingFrequencyType === 4 && loanProductSettingsForm.value.recalculationCompoundingFrequencyNthDayType === -2"
             fxFlex="31%" fxLayout="row" fxLayout.lt-md="column">

          <mat-form-field fxFlexFill>
            <mat-select formControlName="recalculationCompoundingFrequencyOnDayType">
              <mat-option *ngFor="let interestRecalculationOnDayType of interestRecalculationOnDayTypeData" [value]="interestRecalculationOnDayType">
                {{ interestRecalculationOnDayType }}
              </mat-option>
            </mat-select>
          </mat-form-field>

        </div>

      </div>

      <mat-form-field fxFlex="31%">
        <mat-label>{{"labels.inputs.Frequency for recalculate Outstanding Principal" | translate}}</mat-label>
        <mat-select formControlName="recalculationRestFrequencyType" required>
          <mat-option *ngFor="let interestRecalculationFrequencyType of interestRecalculationFrequencyTypeData" [value]="interestRecalculationFrequencyType.id">
            {{ interestRecalculationFrequencyType.value }}
          </mat-option>
        </mat-select>
        <mat-error>
          {{'labels.commons.Frequency for recalculate Outstanding Principal is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

      <div *ngIf="loanProductSettingsForm.value.recalculationRestFrequencyType === 4" fxFlex="31%" fxLayout="row" fxLayout.lt-md="column">

        <mat-form-field fxFlexFill>
          <mat-select formControlName="recalculationRestFrequencyNthDayType">
            <mat-option *ngFor="let interestRecalculationNthDayType of interestRecalculationNthDayTypeData" [value]="interestRecalculationNthDayType.id">
              {{ interestRecalculationNthDayType.value }}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </div>

      <div *ngIf="(loanProductSettingsForm.value.recalculationRestFrequencyType === 4 && loanProductSettingsForm.value.recalculationRestFrequencyNthDayType !== -2) ||
      loanProductSettingsForm.value.recalculationRestFrequencyType === 3" fxFlex="31%" fxLayout="row" fxLayout.lt-md="column">

        <mat-form-field fxFlexFill>
          <mat-select formControlName="recalculationRestFrequencyDayOfWeekType">
            <mat-option *ngFor="let interestRecalculationDayOfWeekType of interestRecalculationDayOfWeekTypeData" [value]="interestRecalculationDayOfWeekType.id">
              {{ interestRecalculationDayOfWeekType.value }}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </div>

      <div *ngIf="loanProductSettingsForm.value.recalculationRestFrequencyType === 4 && loanProductSettingsForm.value.recalculationRestFrequencyNthDayType === -2" fxFlex="31%" fxLayout="row" fxLayout.lt-md="column">

        <mat-form-field fxFlexFill>
          <mat-select formControlName="recalculationRestFrequencyOnDayType">
            <mat-option *ngFor="let interestRecalculationOnDayType of interestRecalculationOnDayTypeData" [value]="interestRecalculationOnDayType">
              {{ interestRecalculationOnDayType }}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </div>

      <mat-checkbox fxFlex="98%" labelPosition="before" formControlName="isArrearsBasedOnOriginalSchedule" class="margin-v">
        {{"labels.inputs.Is Arrears recognization based on original schedule" | translate}}
      </mat-checkbox>

    </div>

    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="23%" class="mat-h3">{{"labels.heading.Guarantee Requirements" | translate}}</h3>

    <mat-checkbox fxFlex="73%" labelPosition="before" formControlName="holdGuaranteeFunds" class="margin-b">
      {{"labels.inputs.Place Guarantee Funds On-Hold?" | translate}}
    </mat-checkbox>

    <div *ngIf="loanProductSettingsForm.value.holdGuaranteeFunds" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

      <mat-form-field fxFlex="31%">
        <mat-label>{{"labels.inputs.Mandatory Guarantee(%)" | translate}}</mat-label>
        <input type="number" matInput formControlName="mandatoryGuarantee" required>
        <mat-error>
          {{'labels.commons.Mandatory Guarantee is' | translate }} <strong>{{'labels.commons.required' | translate }}</strong>
        </mat-error>
      </mat-form-field>

      <mat-form-field fxFlex="31%">
        <mat-label>{{"labels.inputs.Minimum Guarantee from Own Funds(%)" | translate}}</mat-label>
        <input type="number" matInput formControlName="minimumGuaranteeFromOwnFunds">
      </mat-form-field>

      <mat-form-field fxFlex="31%">
        <mat-label>{{"labels.inputs.Minimum Guarantee from Guarantor Funds(%)" | translate}}</mat-label>
        <input type="number" matInput formControlName="minimumGuaranteeFromGuarantor">
      </mat-form-field>

    </div>

    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="23%" class="mat-h3">{{"labels.heading.Event Settings" | translate}} <i class="fas fa-question"
                                                      matTooltip="{{ 'tooltips.Setting for event notifications' | translate }}"></i></h3>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="useDueForRepaymentsConfigurations" matTooltip="{{ 'tooltips.Use or not the Global Configurations values to the Repayment Event (notifications)' | translate }}" class="margin-b">
      {{"labels.inputs.Use the Global Configurations values to the Repayment Event (notifications)" | translate}}
    </mat-checkbox>

    <div fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column" *ngIf="!loanProductSettingsForm.value.useDueForRepaymentsConfigurations">

      <mat-form-field fxFlex="48%">
        <mat-label>{{"labels.inputs.Due days for repayment event" | translate}}</mat-label>
        <input type="number" matInput matTooltip="{{ 'tooltips.Maximum outstanding loan account balance' | translate }}" formControlName="dueDaysForRepaymentEvent">
      </mat-form-field>

      <mat-form-field fxFlex="48%">
        <mat-label>{{"labels.inputs.OverDue days for repayment event" | translate}}</mat-label>
        <input type="number" matInput matTooltip="{{ 'tooltips.Maximum outstanding loan account balance' | translate }}" formControlName="overDueDaysForRepaymentEvent">
      </mat-form-field>
    </div>

    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="100%" class="mat-h3">{{ 'labels.heading.Client InActivity' | translate }} <i class="fas fa-question"
      matTooltip="{{ 'tooltips.Loan settings to lead to change in client status' | translate }}"></i></h3>

    <div fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

      <mat-form-field fxFlex="48%">
        <mat-label>{{ 'labels.inputs.products.loan.Months before being considered inactive' | translate }}</mat-label>
        <input type="number" matInput matTooltip="{{ 'tooltips.Months To Client InActive' | translate}}"
               formControlName="maxClientInactivityPeriod">
      </mat-form-field>
    </div>

    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="23%" class="mat-h3">{{ 'labels.heading.Configurable Terms and Settings' | translate }}</h3>

    <mat-checkbox fxFlex="73%" labelPosition="before" formControlName="allowAttributeConfiguration" class="margin-b">
      {{'labels.inputs.Allow overriding select terms and settings in loan accounts' | translate }}
    </mat-checkbox>

    <div *ngIf="loanProductSettingsForm.value.allowAttributeConfiguration" formGroupName="allowAttributeOverrides" fxFlexFill fxLayout="row wrap" fxLayoutGap="2%" fxLayout.lt-md="column">

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="amortizationType" class="margin-v">
        {{ 'labels.inputs.Amortization' | translate }}
      </mat-checkbox>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="interestType" class="margin-v">
        {{ 'labels.inputs.Interest method' | translate }}
      </mat-checkbox>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="transactionProcessingStrategyCode" class="margin-v">
        {{ 'labels.inputs.Repayment strategy' | translate }}
      </mat-checkbox>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="interestCalculationPeriodType" class="margin-v">
        {{ 'labels.inputs.Interest calculation period' | translate }}
      </mat-checkbox>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="inArrearsTolerance" class="margin-v">
        {{ 'labels.inputs.Arrears tolerance' | translate }}
      </mat-checkbox>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="repaymentEvery" class="margin-v">
        {{ 'labels.inputs.Repaid every' | translate }}
      </mat-checkbox>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="graceOnPrincipalAndInterestPayment" class="margin-v">
        {{ 'labels.inputs.Moratorium' | translate }}
      </mat-checkbox>

      <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="graceOnArrearsAgeing" class="margin-v">
        {{ 'labels.inputs.Number of days a loan may be overdue before moving into arrears' | translate }}
      </mat-checkbox>

    </div>


    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="98%" class="mat-h3">{{ 'labels.heading.Configurable Allowed Usages' | translate }}</h3>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="customAllowCreateOrDisburse" class="margin-b">
      {{ 'labels.inputs.Allow Buy/Advances' | translate }}
    </mat-checkbox>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="customAllowDebitNote" class="margin-b">
      {{ 'labels.inputs.Allow Debit Note' | translate }}
    </mat-checkbox>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="customAllowCreditNote" class="margin-b">
      {{ 'labels.inputs.Allow Credit Note' | translate }}
    </mat-checkbox>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="customAllowForgiveness" class="margin-b">
      {{ 'labels.inputs.Allow Forgiveness' | translate }}
    </mat-checkbox>

    <mat-checkbox fxFlex="48%" labelPosition="before" formControlName="customAllowReversalCancellation" class="margin-b">
      {{ 'labels.inputs.Allow Reversals / Cancelations' | translate }}
    </mat-checkbox>

    <mat-divider fxFlex="98%"></mat-divider>

    <h3 fxFlex="98%" class="mat-h3">{{ 'labels.heading.Configurable Allowed Collections for Sub Channels' | translate }}</h3>

    <mat-checkbox fxFlex="96%" labelPosition="before" formControlName="customAllowCollections" class="margin-b" (change)="setCustomAllowCollections($event.checked)">
      {{ 'labels.inputs.Allow Collections' | translate }}
    </mat-checkbox>

    <div fxFlex="96%" *ngIf="showCollectionDetails" >
      <div fxFlex="30%" >
        <mat-form-field  fxLayoutGap="2%">
          <mat-label>{{ 'labels.inputs.Channel' | translate }}</mat-label>
          <mat-select formControlName="channelId" (selectionChange)="loadSubChannelsForCombobox($event.value);" aria-placeholder="Oi!">
            <mat-option *ngFor="let obj of channelsList" [value]="obj.id">
              {{ obj.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field  fxLayoutGap="2%">
          <mat-label>{{ "labels.inputs.Sub Channel" | translate }}</mat-label>
          <mat-select formControlName="subChannelId" (selectionChange)="setSubChannelVariable($event.value);">
            <mat-option *ngFor="let obj of subChannelsList" [value]="obj.id">
              {{ obj.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <div class="action-button" fxLayoutGap="25px" >
          <!--button mat-raised-button color="primary" [disabled]="!filterForm.valid" (click)="submit()" *mifosxHasPermission="'CREATE_CUSTOMCHARGETYPEMAP'">{{"labels.buttons.Submit" | translate }}</button-->
          <button mat-raised-button color="primary" [disabled]="this.apiDataClone.length > 0 || channelId == null || subChannelId == null" (click)="addLoadSubChannel()" *mifosxHasPermission="'CREATE_CUSTOMCHARGETYPEMAP'">{{"labels.buttons.Submit" | translate }}</button>
        </div>
      </div>

      <table mat-table #instructionsTable [dataSource]="dataSource">

        <ng-container matColumnDef="channelName">
          <th mat-header-cell *matHeaderCellDef> {{  "labels.inputs.Channel Name" | translate}} </th>
          <td mat-cell *matCellDef="let instruction">{{instruction.channelName}}
          </td>
        </ng-container>

        <ng-container matColumnDef="subChannelName">
          <th mat-header-cell *matHeaderCellDef> {{"labels.inputs.Sub Channel Name" | translate}} </th>
          <td mat-cell *matCellDef="let instruction">{{instruction.subChannelName}}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> {{  "labels.inputs.Actions" | translate}} </th>
          <td mat-cell *matCellDef="let instruction">
            <button class="account-action-button" mat-raised-button color="primary" matTooltip="View Standing Instruction"
                    (click)="deleteItem(instruction.id)"
                    *mifosxHasPermission="'READ_STANDINGINSTRUCTION'">
              <i class="fa fa-trash"></i>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>

    </div>

  </div>

  <div fxLayout="row" class="margin-t" fxLayout.xs="column" fxLayoutAlign="center" fxLayoutGap="2%">
    <button mat-raised-button matStepperPrevious>
      <fa-icon icon="arrow-left" class="m-r-10"></fa-icon>
      {{'labels.buttons.Previous' | translate}}
    </button>
    <button mat-raised-button matStepperNext>
      {{'labels.buttons.Next' | translate}}
      <fa-icon icon="arrow-right" class="m-l-10"></fa-icon>
    </button>
  </div>

</form>
